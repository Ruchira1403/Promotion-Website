stage('Prepare SSH Key') {
    steps {
        script {
            // Create directories if they don't exist
            bat '''
                if not exist ansible mkdir ansible
                wsl mkdir -p /home/myuser/.ssh
            '''
            
            // Test basic connectivity with ping
            echo "Testing connectivity to EC2 instance with ping..."
            bat "ping -n 4 13.218.143.183"
            
            // Set proper permissions on existing key
            bat '''
                wsl chmod 600 /home/myuser/.ssh/Promotion-Website.pem
                wsl ls -la /home/myuser/.ssh/Promotion-Website.pem
            '''
            
            // Verify SSH connection
            bat '''
                wsl ssh -o StrictHostKeyChecking=no -i /home/myuser/.ssh/Promotion-Website.pem ubuntu@13.218.143.183 "echo SSH connection successful"
            '''
        }
    }
}